#!/usr/bin/env bash
# Launch Unifi Drive in isolated Chromium profile with 1Password

PROFILE="$HOME/.config/chromium-unifi"
URL="https://unifi.ui.com/consoles/D8B3708BEE790000000007A692B9000000000808C0B90000000064D18FC0:1329967531/drive/dashboard"

ONEPASS_EXT=$(find ~/.config/chromium/Default/Extensions/aeblfdkhhhdcdjpifhhbdiojplfjncoa -maxdepth 1 -mindepth 1 -type d 2>/dev/null | head -1)

window=$(hyprctl clients -j | jq -r '.[] | select(.title | test("Drive"; "i")) | select(.class | test("unifi"; "i")) | .address' | head -1)

if [[ -n "$window" ]]; then
    hyprctl dispatch focuswindow "address:$window"
else
    if [[ -n "$ONEPASS_EXT" ]]; then
        chromium --user-data-dir="$PROFILE" --load-extension="$ONEPASS_EXT" --disable-popup-blocking --app="$URL" &
    else
        chromium --user-data-dir="$PROFILE" --disable-popup-blocking --app="$URL" &
    fi
fi
