#!/usr/bin/env bash
# Launch github in isolated Chromium profile with 1Password

PROFILE="$HOME/.config/chromium-github"
URL="https://github.com"

# Find 1Password extension (latest version)
ONEPASS_EXT=$(find ~/.config/chromium/Default/Extensions/aeblfdkhhhdcdjpifhhbdiojplfjncoa -maxdepth 1 -mindepth 1 -type d 2>/dev/null | head -1)

window=$(hyprctl clients -j | jq -r '.[] | select(.class | test("github"; "i")) | .address' | head -1)

if [[ -n "$window" ]]; then
    hyprctl dispatch focuswindow "address:$window"
else
    if [[ -n "$ONEPASS_EXT" ]]; then
        chromium --user-data-dir="$PROFILE" --load-extension="$ONEPASS_EXT" --disable-popup-blocking --app="$URL" &
    else
        chromium --user-data-dir="$PROFILE" --disable-popup-blocking --app="$URL" &
    fi
fi
