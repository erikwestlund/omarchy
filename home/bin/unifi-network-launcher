#!/usr/bin/env bash
# Launch Unifi Network in isolated Chromium profile with 1Password

PROFILE="$HOME/.config/chromium-unifi"
URL="https://unifi.ui.com/consoles/1C0B8B18F0D8000000000927FE2A0000000009A5BB4F00000000683F1972:601624196/network/default/dashboard"

ONEPASS_EXT=$(find ~/.config/chromium/Default/Extensions/aeblfdkhhhdcdjpifhhbdiojplfjncoa -maxdepth 1 -mindepth 1 -type d 2>/dev/null | head -1)

window=$(hyprctl clients -j | jq -r '.[] | select(.title | test("Network"; "i")) | select(.class | test("unifi"; "i")) | .address' | head -1)

if [[ -n "$window" ]]; then
    hyprctl dispatch focuswindow "address:$window"
else
    if [[ -n "$ONEPASS_EXT" ]]; then
        chromium --user-data-dir="$PROFILE" --load-extension="$ONEPASS_EXT" --app="$URL" &
    else
        chromium --user-data-dir="$PROFILE" --app="$URL" &
    fi
fi
