#!/bin/bash
# Display mode menu - switch between clamshell and dual-screen configurations

LAPTOP="eDP-1"
EXTERNAL="desc:GKT Kuycon G32P"

# Get current external monitor port (DP-1, DP-3, DP-4, etc.)
get_external_port() {
    hyprctl monitors -j | jq -r '.[] | select(.description == "GKT Kuycon G32P") | .name'
}

# Move all numbered workspaces to external, U to laptop
setup_workspaces() {
    local ext_port=$(get_external_port)
    for i in 1 2 3 4 5 6 7 8 9 10 11 12 13; do
        hyprctl dispatch moveworkspacetomonitor "$i $ext_port" 2>/dev/null
    done
    hyprctl dispatch moveworkspacetomonitor "name:U $LAPTOP" 2>/dev/null
    hyprctl dispatch focusmonitor "$ext_port"
    hyprctl dispatch workspace 1
}

action=$(echo -e "Clamshell\nTwo Displays (Laptop on Right)\nTwo Displays (Laptop on Left)" | walker --dmenu -p "Display Mode:")

case "$action" in
    "Clamshell")
        ext_port=$(get_external_port)
        hyprctl dispatch moveworkspacetomonitor "name:U $ext_port" 2>/dev/null
        hyprctl keyword monitor "$LAPTOP,disable"
        notify-send "Display Mode" "Clamshell"
        ;;
    "Two Displays (Laptop on Right)")
        hyprctl keyword monitor "$EXTERNAL,6144x3456@60,0x0,2"
        hyprctl keyword monitor "$LAPTOP,2880x1920@120,3072x0,2"
        sleep 0.3
        setup_workspaces
        notify-send "Display Mode" "Laptop on Right"
        ;;
    "Two Displays (Laptop on Left)")
        hyprctl keyword monitor "$EXTERNAL,6144x3456@60,1440x0,2"
        sleep 0.1
        hyprctl keyword monitor "$LAPTOP,2880x1920@120,0x0,2"
        sleep 0.3
        setup_workspaces
        notify-send "Display Mode" "Laptop on Left"
        ;;
esac
