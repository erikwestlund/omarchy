#!/bin/bash
# Kill script for {{ project_name }}
# Generated by Ansible - edit the template, not this file

PROJECT_NAME="{{ project_name }}"
{% if project_path | length > 0 %}
PROJECT_DIR="{{ project_path }}"
{% else %}
PROJECT_DIR="$HOME/Omarchy/projects/{{ project_name }}"
{% endif %}

echo "Stopping $PROJECT_NAME..."

# Stop Docker services
{% if docker_compose | default(false) %}
if [ -f "$PROJECT_DIR/docker-compose.yml" ]; then
    echo "Stopping Docker services..."
    (cd "$PROJECT_DIR" && docker compose down)
fi
{% endif %}

# Kill VS Code window for this project
echo "Closing VS Code..."
VSCODE_ADDRS=$(hyprctl clients -j | jq -r --arg dir "$PROJECT_DIR" '.[] | select(.class == "code" or .class == "Code") | select(.title | contains($dir) or contains("{{ project_name }}")) | .address')
for addr in $VSCODE_ADDRS; do
    hyprctl dispatch closewindow "address:$addr" 2>/dev/null
done

# Kill any browser windows opened for this project's view URL
{% if view_url | default('') | length > 0 %}
echo "Closing view windows..."
# Best effort - browsers don't always have predictable window titles
{% endif %}

echo "Done! $PROJECT_NAME stopped."
